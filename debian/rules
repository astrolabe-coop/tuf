#!/usr/bin/make -f

export DH_VERBOSE = 1
export PYBUILD_NAME = tuf
export PYBUILD_DISABLE_python3 = test
export DEB_BUILD_OPTIONS += nocheck

PYVERS ?= $(shell py3versions -rv)
TOX_OPTIONS += --recreate

%:
	dh $@ --with python3  --buildsystem=pybuild

override_dh_install:
	dh_install
	rm -rfv debian/*/usr/bin/*.py

override_dh_auto_test:
ifeq (,$(findstring nocheck,$(DEB_BUILD_OPTIONS)))
	sed -e 's/--use-deprecated=legacy-resolver//g' -i tox.ini
	tox -l
	for py in $(PYVERS); do \
  env=$$(echo "py$${py}" | tr -d '.') ; \
  tox ${TOX_OPTIONS} -e "$${env}" -- -s ; \
done
endif

override_dh_auto_clean:
	rm -rf .tox
	dh_auto_clean
