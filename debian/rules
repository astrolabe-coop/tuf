#!/usr/bin/make -f

export DH_VERBOSE = 1
export PYBUILD_NAME = tuf

PYVERS ?= $(shell py3versions -rv)
TOX_OPTIONS += --sitepackages

%:
	dh $@ --with python3  --buildsystem=pybuild

override_dh_install:
	dh_install
	rm -rfv debian/*/usr/bin/*.py

override_dh_auto_test:
ifeq (,$(findstring nocheck,$(DEB_BUILD_OPTIONS)))
	sed -e 's/--use-deprecated=legacy-resolver//g' -i tox.ini
	tox -l
	for py in $(PYVERS); do \
  env=$$(echo "py$${py}" | tr -d '.') ; \
  tox ${TOX_OPTIONS} -e "$${env}" -- -s ; \
done
endif

override_dh_auto_clean:
	rm -rf .tox
	dh_auto_clean

override_dh_installdocs:
	dh_installdocs
	ln -fs tuf-spec.md \
debian/python3-tuf-doc/usr/share/doc/python3-tuf/docs/tuf-spec.txt
